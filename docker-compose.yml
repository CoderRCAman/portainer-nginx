version: "3.9"

services:
  nginx:
    image: ghcr.io/coderrcaman/nginx-proxy:latest
    deploy:
      mode: replicated
      replicas: 1
      restart_policy:
        condition: on-failure
      update_config:
        parallelism: 1
        order: start-first
      endpoint_spec:
        mode: vip
      placement:
        constraints: [node.role == manager]
      # ðŸ‘‡ Publish ports explicitly for Swarm
      ports:
        - target: 80
          published: 80
          protocol: tcp
          mode: host
        - target: 443
          published: 443
          protocol: tcp
          mode: host
    networks:
      - app-net

networks:
  app-net:
    external: true
